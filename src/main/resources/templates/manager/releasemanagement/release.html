<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate ="~{layout/defaultmanager}">

<!-- 사용자 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
    <script src="/assets/js/toppos/manager/releasemanagement/release.js"></script>
    <!-- 엑셀 다운로드 기능을 사용하기 위함 -->
	<script src="/assets/js/filesaver/FileSaver.min.js"></script>

    <script>

        function dispatchPrintTest(){
            console.log("출고증인쇄");
            const url = "/api/manager/branchDispatchPrint";
            CommonUI.ajax(url, "GET", null, function (res) {
                console.log();
                for(i=0; i<res.sendData.issueDispatchDtos.length; i++){
                    const frCode = res.sendData.issueDispatchDtos[i]["qrCode"];
                    res.sendData.issueDispatchDtos[i]["qrCode"] = location.protocol+"//"+location.host+"/qrpickup?frcode="+frCode;
                }
                console.log(res.sendData.issueDispatchDtos);
                dispatchPrintTestData(res.sendData.issueDispatchDtos)
            });

        }

        function dispatchPrintTestData(dataset_0){
            // 프로젝트명
            const projectName = "toppos";
            // 서식명
            const formName = "dispatchPrint02";

            //데이터셋 Object
            const datasetObject = {};
            //데이터셋 Object에 생성된 DataSet 추가
            datasetObject.dataset_0 = JSON.stringify(dataset_0);
            //파라미터 Object
            const paramObject = {};
            //파라미터
            //paramObject.stDt = "2019-01-31";
            //aramObject.endDt = "2019-12-31";
            //뷰어 오픈 공통 함수 호출
            fn_viewer_open(projectName, formName, datasetObject, paramObject);
        }


        function fn_viewer_open(projectName, formName, datasetObject, paramObject){
            var _params = {
                "projectName":projectName, 			//프로젝트명
                "formName":formName             //서식명
            };
            for (var datasetValue in datasetObject) {
                _params[datasetValue] = encodeURIComponent(datasetObject[datasetValue]);
            }
            for (var paramValue in paramObject) {
                _params[paramValue] = paramObject[paramValue];
            }

            var _url = "https://report.topcleaners.kr:443" + "/UBIFORM/UView5/index.jsp"; //UBIFORM Viewer URL
            //팝업 오픈 Option 해당 설정은 window.open 설정을 참조
            //var windowoption = 'location=0, directories=0,resizable=0,status=0,toolbar=0,menubar=0, width=1280px,height=650px,left=0, top=0,scrollbars=0';  //팝업사이즈 window.open참고
            var windowoption = 'width=1280px,height=650px';
            var d = new Date();
            var n = d.getTime();
            var name = "UBF_" + n;
            //팝업사이즈 window.open참고
            var form = document.createElement("form");
            form.setAttribute("method", "post");
            form.setAttribute("action", _url);
            params = _params ;
            for (var i in params)
            {
                if (params.hasOwnProperty(i))
                {
                    var param = document.createElement('input');
                    param.type = 'hidden';
                    param.name = i;
                    param.value = encodeURI( params[i] );
                    form.appendChild(param);
                }
            }
            document.body.appendChild(form);
            form.setAttribute("target", name);
            window.open("", name, windowoption);
            form.submit();
            document.body.removeChild(form);
        }



    </script>


</th:block>

<div layout:fragment="content" class="content">
    <section class="section">
        <article class="article">
            <div class="article__header">
                <h3 class="article__heading">지사출고</h3>
            </div>
            <div class="article__body">
                <div class="inquiry">
                    <div class="inquiry__condition">
                        <ul>
                            <li>
                                <div class="inquiry__title">출고작업유형</div>
                                <div class="inquiry__input">
                                    <div class="c-radio">
                                        <input type="radio" name="type" id="type01" value="" checked=""/>
                                        <label for="type01">통합출고</label>
                                    </div>
                                    <div class="c-radio">
                                        <input type="radio" name="type" id="type02" value="" />
                                        <label for="type02">가맹점선택출고</label>
                                    </div>
                                </div>
                            </li>
                            <li id="frSelectUI" style="display: none;">
                                <div class="inquiry__title">가맹점</div>
                                <div class="inquiry__input">
                                    <div class="c-select">
                                        <select id="frList">
                                            <option value="0">전체</option>
                                        </select>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="inquiry__title">입고일자</div>
                                <div class="inquiry__input">
                                    <div class="c-period">
                                        <!-- 시작일 -->
                                        <input type="text" id="filterFromDt">
                                        <span class="c-period__code">-</span>
                                        <!-- 종료일 -->
                                        <input type="text" id="filterToDt">
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="inquiry__input">
                                    <div class="c-checkbox">
                                        <input type="checkbox" id="isUrgent" />
                                        <label for="isUrgent">급세탁</label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="inquiry__button">
                        <button id="getListBtn" class="c-button c-button--small c-button--darksolid">조회</button>
                    </div>
                </div>
            </div>
        </article>

        <article class="article">
            <div class="release-console">
                <div class="release-console__tag">
                    <div class="release-console__tag-title">택번호</div>
                    <div class="release-console__tag-input">
                        <input id="inputTagNo" type="text" />
                    </div>
                    <button id="inputTagBtn" class="c-button c-button--small">선택</button>
                    <button type="button" id="exportXlsx" 
                    class="c-button c-button--green c-button--icon c-button--icon-excel" style="display: none;">
                    엑셀 다운로드</button>
                </div>
                <div id="listStatBar" class="release-console__list">
                    <div id="statPanel" class="release-console__comment">조회버튼을 통해 상품을 조회하세요.</div>
                    <ul class="release-console__btn-list">
                        <li id="addAll"><button class="release-console__btn">전체리스트 보기</button></li>
                        <li id="clearUnchecked"><button class="release-console__btn">전체리스트 숨기기</button></li>
                    </ul>
                </div>
            </div>
        </article>

        <div class="article article--flex article--non-margin">
            <div class="article__body">
                <!-- <ul class="article__console article__console--left article__console--non-border">
                    <li>
                        <button class="c-button c-button--solid">전체선택</button>
                    </li>
                    <li>
                        <button class="c-button c-button--darksolid">선택취소</button>
                    </li>
                </ul> -->
                <div style="width: 100%; height: 500px; border: 1px solid #bdbdbd;">
                    <div id="grid_main" style="height: 500px;"></div>
                </div>
            </div>

            <div class="article__body" style="flex: 0 1 auto; width: 17.5rem;">
                <div class="article__header">
                    <h3 class="article__heading">출고 선택 품목 요약</h3>
                </div>
                <div class="article__body">
                    <div id="grid_selected" style="width: 100%; height: 348px; border: 1px solid #bdbdbd;"></div>
                    <div class="process">
                        <div class="process__count">
                            <div class="process__count-input"><input id="miDegree" type="text" value="1" maxlength="2" /></div>
                            <span>차 출고</span>
                        </div>
                        <div class="process__btn">
                            <button onclick="dispatchPrintTest()" class="c-button">출고증인쇄테스트</button>
                            <button id="sendOutBtn" class="c-button">출고처리</button>
                            <span>(출고증 인쇄)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
</html>
