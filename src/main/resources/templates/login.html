<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate ="~{layout/default}">

<th:block layout:fragment="script">
	<script type="text/javascript">

		 function loginActive() {

		 	const $userid = $("#userid");
		 	const $password = $("#password");

		 	if ($userid.val().trim() === '') {
		 		alertCaution("아이디를 입력하세요.");
		 		$userid.trigger('focus');
		 		return false;
		 	}
		 	if ($password.val().trim() === '') {
		 		alertCaution("비밀번호을 입력하세요.");
		 		$password.trigger('focus');
		 		return false;
		 	}

		 	const params = {
		 		userid : $userid.val(),
		 		password : $password.val()
		 	};

		 	const jsonString = JSON.stringify(params);

		 	console.log("로그인 실행");
		 	$.ajax({
		 		url: '/auth/login',
		 		type: 'post',
		 		data: jsonString,
		 		contentType: 'application/json',
		 		cache: false,
		 		error: function (req) {
		 			ajaxErrorMsg(req);
		 		},
		 		success: function (res) {
		 			// console.log("로그인 되었습니다.");
		 			// console.log("AccessToken : "+res.sendData.tokenDto.accessToken);
		 			localStorage.setItem("Authorization",res.sendData.tokenDto.accessToken); // 로컬 웹스토리지안에 토큰을 저장한다.
					mainPage();
		 		}
		 	});
		 }

		 function mainPage(){
			 $(document).ajaxSend(function(e, xhr) { xhr.setRequestHeader("Authorization",localStorage.getItem('Authorization')); });
			 $.ajax({
			 	url: '/',
			 	type: 'get',
			 	contentType: 'application/json',
			 	cache: false,
			 	error: function (req) {
			 		ajaxErrorMsg(req);
			 	},
			 	success: function (res) {
					location.href= res.sendData.link;
			 		// console.log("이동완료");
			 	}
			 });
		 }

	</script>
</th:block>

<div layout:fragment="content" class="login-wrap">

	<div class="login">
		<h1 class="login__logo">
			<a href="/login" class="logo">
				<span>Toppos Login</span>
			</a>
		</h1>
		<div class="login__form-box">
				<div>
					<label><input type="text" class="login__input"  id="userid" name="userid" placeholder="아이디를 입력하세요." required ></label>
				</div>
				<div style="margin-top: 10px">
					<label><input type="password" class="login__input" id="password" name="password" placeholder="패스워드를 입력하세요." required></label>
				</div>
				<div><input class="login__btn" type="button" value="로그인" onclick="loginActive()" /></div>
<!--				<div><a class="login__btn" href="/register">회원가입</a></div>-->
		</div>
	</div>
</div>

</html>